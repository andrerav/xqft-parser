\section{Comparison}
\label{sect:results:comparison}
\subsection{Assumptions}
This comparison must be seen in the context of a number of assumptions
about the systems being compared. With regards to fairness, it is important to
note that the algebra trees generated by Pathfinder may have been
simplified (to which the exact extent is not known), while the algebra trees
generated by the prototype developed throughout this project \emph{does not
apply any simplifications or optimalisations} at all. The simplifications
possibly applied by Pathfinder are noted in \cite{pathfinder_purelyRelational}.

Some important effects on the Pathfinder algebra tree from these
optimalisations are typically:
\begin{itemize}
  \item The cartesian products between a loop relation and a constant
  subexpression are transformed into projections
  \item The custom operator \textsf{attach} is roughly a simpler equivalent to
  a \textsf{project()} where a new field with a constant field is added
\end{itemize}

\newpage
\subsection{DAG comparison}
Note that the readability for these DAG comparisons are not essential --
however, links to large-scale versions of these diagrams are noted in appendix
\ref{appendix:links_and_resources}.

\begin{figure}[!h]
	\centering
	\mbox{
		\subfigure[Pathfinder/MonetDB]{		
			\includegraphics[width=0.4\textwidth]{img/graphs/td_impl_flwor_simple_pathfinder}
			\label{fig:result:comparison:simple_dag}
		}
		\quad
		\subfigure[Prototype implementation]{
		
			\includegraphics[width=0.6\textwidth]{img/graphs/td_impl_flwor_simple_xq_relalg}
			\label{fig:result:comparison:simple_pathfinder_dag}
		}
	}
	\caption{Comparison of DAGs for the trivial expression in section
	\ref{sect:results:algebra:generated:trivial_flwor}}
	\label{fig:results:comp:trivial}
\end{figure}

Figure \ref{fig:results:comp:trivial} compares the DAGs generated for the
trivial expression in section
\ref{sect:results:algebra:generated:trivial_flwor}. As expected, both
implementations produces relatively small algebra for this example.

\newpage
\begin{figure}[!h]
	\centering
	\mbox{
		\subfigure[Pathfinder/MonetDB]{		
			\includegraphics[width=0.263\textwidth]{img/graphs/td_impl_flwor_ifthenelse_pathfinder}
			\label{fig:result:comparison:conditional_dag}
		}
		\quad
		\subfigure[Prototype implementation]{
		
			\includegraphics[width=0.7\textwidth]{img/graphs/td_impl_flwor_ifthenelse_xq_relalg_dag}
			\label{fig:result:comparison:conditional_pathfinder_dag}
		}
	}
	\caption{Comparison of DAGs for the conditional expression in section
	\ref{sect:results:algebra:generated:conditional_flwor}}
	\label{fig:results:comp:conditional}
\end{figure}

Figure \ref{fig:results:comp:conditional} compares the DAGs generated for the
conditional expression in section
\ref{sect:results:algebra:generated:conditional_flwor}. The immediate
impression may be that the algebra generated by Pathfinder is substantially more
complex, however this stems partly from the numerous \textsf{Attach} operators.
Also note that Pathfinders algebra contains three joins, whereas the algebra
generated by our prototype only contains two joins.

\newpage
\begin{figure}[!h]
	\centering
	\mbox{
		\subfigure[Pathfinder/MonetDB]{		
			\includegraphics[width=0.326\textwidth]{img/graphs/td_impl_flwor_complex_pathfinder}
			\label{fig:result:comparison:complex_xqft_dag}
		}
		\quad
		\subfigure[Prototype implementation]{
		
			\includegraphics[width=0.6\textwidth]{img/graphs/td_impl_flwor_complex_xq_relalg_dag}
			\label{fig:result:comparison:complex_pathfinder_dag}
		}
	}
	\caption{Comparison of DAGs for the complex expression in section
	\ref{sect:results:algebra:generated:complex_flwor}}
	\label{fig:results:comp:complex}	
\end{figure}

Figure \ref{fig:results:comp:complex} compares the DAGs generated for the
complex expression in section
\ref{sect:results:algebra:generated:complex_flwor}. Again it may seem that
Pathfinders algebra is substantially more complex, however this fact is,
as in the previous comparison, partly magnified due to the numerous
\textsf{Attach} operators.

\newpage
\subsection{Complexity estimation and comparison}
Complexity estimation is performed as detailed in section
\ref{sect:method:complexity}. The comparison matrix shown in table
\ref{table:result:complexity_matrix} details the differences in
\textit{complexity}. This result is also charted in figures
\ref{fig:results:comparison:chart1} and \ref{fig:results:comparison:chart2}.

Refer to Section \ref{sect:method:complexity} on page
\pageref{sect:method:complexity} for a detailed account of how these complexity
estimations are made.

\begin{table}[!htp]
 \begin{center} 
 \begin{tabular}{| c | c | c || c | c |}
  \hline
   & \multicolumn{2}{|c||}{\textbf{Pathfinder}}
   & \multicolumn{2}{|c|}{\textbf{Prototype}} \\
   \hline
   & Tuples & Fields & Tuples & Fields \\  
   \hline
   Trivial & 16 & 16 & 15 & 18 \\  
   \hline
   Complex & 215 & 265 & 136 & 102 \\
   \hline
   Conditional & 94 & 50 & 31 & 44 \\  
   \hline
 \end{tabular}
\caption{Complexity comparison matrix}
\label{table:result:complexity_matrix}
 \end{center}
\end{table}

For the trivial example, the generated algebra seems to be close in complexity.
However, for the more extensive examples, the complexity of the algebra
generated by Pathfinder seems substantially larger. For example, consider the
``complex'' example where Pathfinder seems to produce 58\% more tuples and
almost 160\% more fields.

\begin{figure}[!htp]
\begin{center}
  \includegraphics[width=1.0\textwidth]{diagrams/comparison_chart2_chart1}
  \caption{Comparison of complexity based on tuple creation}
  \label{fig:results:comparison:chart1}
\end{center}
\end{figure}

\begin{figure}[!htp]
\begin{center}
  \includegraphics[width=1.0\textwidth]{diagrams/comparison_chart2_chart2}
  \caption{Comparison of complexity based on field creation}
  \label{fig:results:comparison:chart2}
\end{center}
\end{figure}

\newpage
The \textit{tuple I/O complexity} differences for \textsf{join}
and \textsf{sort} operators are shown in tables
\ref{table:result:complexity_matrix_tio_1} and
\ref{table:result:complexity_matrix_tio_1}.

% Joins
\begin{table}[!htp]
 \begin{center}
 \begin{tabular}{| c | c | c | c | c | c | c | c |}
  \hline
   & \multicolumn{7}{|c|}{\textbf{Pathfinder}} \\
   \hline
   &  & \multicolumn{3}{|c|}{\textbf{In}} &
   \multicolumn{3}{|c|}{\textbf{Out}}  \\
   \hline
   &  \# & Min & Max & Avg & Min & Max & Avg\\
   \hline
   Trivial & 0 & 0 & 0 & 0 & 0 & 0 & 0  \\
   \hline
   Complex & 3 & 6 & 14 & 12.67 & 4 & 14 & 10  \\
   \hline
   Conditional & 3 & 4 & 6 & 4.67 & 1 & 2 & 1.67  \\
   \hline
   %\hline
   & \multicolumn{7}{|c|}{\textbf{Prototype}} \\
   \hline
   &  & \multicolumn{3}{|c|}{\textbf{In}} & 
   \multicolumn{3}{|c|}{\textbf{Out}} \\
   \hline
   & \# & Min & Max & Avg & Min & Max & Avg \\ 
   \hline 
   Trivial & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
   \hline
   Complex & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
   \hline
   Conditional & 2 & 3 & 6 & 4.5 & 3 & 6 & 4.5 \\
   \hline
 \end{tabular}
\caption{Tuple input/output in join operators}
\label{table:result:complexity_matrix_tio_1}
 \end{center}
\end{table}

Considering Table \ref{table:result:complexity_matrix_tio_1}, it seems that for
the ``complex'' example, the prototype implementation does not produce any
join operators at all, while Pathfinder produces three join operators. Also
note that for the same example, Pathfinder has an average of 12.67 input tuples.

% Sorts
\begin{table}[!htp]
 \begin{center}
 \begin{tabular}{| c | c | c | c | c | c | c | c |}
  \hline
   & \multicolumn{7}{|c|}{\textbf{Pathfinder}} \\
   \hline
   &  & \multicolumn{3}{|c|}{\textbf{In}} &
   \multicolumn{3}{|c|}{\textbf{Out}}  \\
   \hline
   &  \# & Min & Max & Avg & Min & Max & Avg\\
   \hline
   Trivial & 1 & 3 & 3 & 3 & 3 & 3 & 3  \\
   \hline
   Complex & 6 & 2 & 14 & 8.8 & 2 & 14 & 8.8  \\
   \hline
   Conditional & 2 & 2 & 2 & 2 & 2 & 2 & 2  \\
   \hline
   %\hline
   & \multicolumn{7}{|c|}{\textbf{Prototype}} \\
   \hline
   &  & \multicolumn{3}{|c|}{\textbf{In}} &
   \multicolumn{3}{|c|}{\textbf{Out}} \\
   \hline
   & \# & Min & Max & Avg & Min & Max & Avg \\
   \hline
   Trivial & 2 & 3 & 3 & 3 & 3 & 3 & 3 \\
   \hline
   Complex & 6 & 2 & 14 & 9.33 & 2 & 14 & 9.33 \\
   \hline
   Conditional & 2 & 2 & 2 & 2 & 2 & 2 & 2 \\
   \hline
 \end{tabular}
\caption{Tuple input/output in sort operators}
\label{table:result:complexity_matrix_tio_2}
 \end{center}
\end{table}

Table \ref{table:result:complexity_matrix_tio_2} shows that in the
case of sort operators, Pathfinder and the prototype are more equal in
complexity
