\section{Theoretical Algebra}
In this section, a collection of XQuery query examples and their translation to
relational algebra is presented. The translation is done manually using the
``Tainting Dependencies'' method described in section
\ref{sect:trans:taintingDependencies}. For the sake of brevity, only the
rules used throughout the translation will be noted. Intermediate results will
not be included.

Generell struktur:
- Sp\oe rring
- Semantikk (resultat)
- Translasjon
- Mellomregninger? (naaii..)

\subsection{Extensive FLWOR}
This example will illustrate the translation of a more complex FLWOR expression.

\subsubsection{Query premise}
\begin{figure}[htp]
\begin{center}
\begin{Verbatim}
for $a in (1,2,3) let $b := 2
  where $a gt 2
  order by $a
  return $a
\end{Verbatim}
  \caption{Extensive FLWOR expression, showcasing for-, let-, where-, orderby-,
  and return-clauses}
  \label{fig:results:query_ext_flwor}
\end{center}
\end{figure}

\subsubsection{Translation}
The translation process is initiated by entering the FLWOR expression in the
syntax tree and visiting the for- and let-clauses. Recall from section
\ref{sect:trans:TD:basics} on page \pageref{sect:trans:TD:basics} that
\textbf{r}($e$) returns the translation of the XQuery expression $e$ into
relational algebra. This function is then defined through a set of rules
described throughout section \ref{sect:trans:taintingDependencies}.

The translation process starts with the for-clause which we translate using
rule \ref{rule:trans:TD:forbind}. However, to produce \textbf{r}($e$), we must
translate \texttt{(1,2,3)} using rule \ref{rule:trans:TD:seqConstr} and
\ref{rule:trans:TD:literal}. 

By applying rule \ref{rule:trans:TD:literal} to each of the elements in the
sequence, we obtain the following translations:
\begin{Verbatim}
make(name:=[value],1)
\end{Verbatim}
\begin{Verbatim}
make(name:=[value],2)
\end{Verbatim}
\begin{Verbatim}
make(name:=[value],3)
\end{Verbatim}

By applying rule \ref{rule:trans:TD:seqConstr} to this result we obtain the
following translation of the sequence (1,2,3):

\begin{Verbatim}
numberate(index,[sprIdx,index],[];
  union(;
    project(sprIdx=1,index=0,value;
      make(name:=[value],1)),
    project(sprIdx=2,index=0,value;
      make(name:=[value],2)),
    project(sprIdx=3,index=0,value;
      make(name:=[value],3))))
\end{Verbatim}

We can now continue translating the for-clause, as the above translation
equates to \textbf{r}($e$). By rule \ref{rule:trans:TD:forbind}, we obtain the
following translation which is to be entered into the symbol table for this
scope (for the symbol $\chi$ = a):

\begin{Verbatim}
project([anumb = index, index = 1, value];
  numberate(index,[sprIdx,index],[];
    union(;
      project(sprIdx=1,index=0,value;
        make(name:=[value],1)),
      project(sprIdx=2,index=0,value;
        make(name:=[value],2)),
      project(sprIdx=3,index=0,value;
        make(name:=[value],3))))
\end{Verbatim}

Any later reference to \texttt{\$a} is now replaced with a lookup in the symbol
table which will return this algebra expression.


\subsubsection{Semantics}


\subsection{Path expression with predicate}
\begin{Verbatim}
/a/b[@id = 2] ?
\end{Verbatim}

\subsection{If-then-else}
\begin{Verbatim}
for $a in (1,2,3) return 
  if $a > 2 then $a else 3
\end{Verbatim}


\section{Algebra Generated By Implementation}
In this section, a collection of trivial queries are translated to relational
algebra using the implemented proof of concept described in chapter
\ref{chapter:implementation}. Naturally, this implementation also uses the
``Tainting Dependencies'' method, however the results from these translations
can also be used in a comparison with loop lifting.

\subsection{FLWOR}
\subsection{Sequence construction}

\begin{itemize}
  \item to-tre st√∏rre eksempler som benytter seg av Tainted Dependencies [skal
  disse v\ae re med mellomregninger og slikt? huff]
  \item et eksempel generert av implementasjonen [bare ett?]
\end{itemize}