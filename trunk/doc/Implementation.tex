\chapter{Implementation}
\label{chapter:implementation}

\begin{itemize}
  \item intro
  \item Vi lager en liten prototype = ``proof of concept'' -> et begrep vi m\aa~bruke =)
  \item VarRefs m\aa~sendes oppover fra child nodes (ref til tainting deps)
  \item Optimalisering: child nodes vet om de er atomiske/singleton eller ikke
\end{itemize}

\begin{itemize}
  \item Bruk av parseren (den som er generert av antlr osv), XQFTTree-klassen,
  evt. UML
  \item Interfacing av parseren mot oversetteren v\aa r (som oversetter til
  relalg) og UML
  \item Bygging av relasjonsalgebra-tre, UML av operatorklassene
  \item Implementering av visitors
  \item Scoping og symtab (nok en gang..)
  \item hvordan metadata som varrefs og singletonindikering blir sendt oppover
  (Metadata)
  \item Implementering av ``tainting dependencies''
  \item Dataflyt ()
  \item Visible external API
  \item Interface til systemet p\aa~ kommandolinjen
  \item Optimaliseringer, om noen? 
\end{itemize}

\section{Prerequisites}
This proof of concept was implemented in Java 5.0, using regular object
oriented techniques, and is licensed under a liberal BSD license. 

\input{implementation/TheXQFTParser.tex}

\section{Constructing the MQL algebra tree}
\subsection{Operators and parameters}
\subsection{Concepts}
\subsection{Usage}

\section{Context-sensitive visitor}
\subsection{Basics}
\subsection{Modifying the XQFTTree class}
\subsection{Rewrite visitor}
\subsection{Translation visitor}

\section{Scoping and symbol tables}
\begin{itemize}
  \item Holder styr p\aa~variabler, og om de er iterasjonsvariabler i n\aa v\ae
  rende scope
  \item Scope pushes rett f\oe r forclause, og poppes etter at returnclausen har
  blitt evaluert
  \item Symbolene er innkapslet i en symtabentry som inneholder metadata
\end{itemize}

\section{Passing metadata between nodes}
\subsection{Variable references}
\subsection{Singleton nodes}
\subsection{The TraverseReturn class}

\section{Tainting dependencies}
Dette blir den lengste seksjonen i dette kapittelet, h\aa per jeg.
\subsection{FLWOR expressions}
\subsection{Sequences}
\begin{itemize}
  \item behandler parantes istf. komma for sekvenser (ref spec) 
\end{itemize}

\section{Data flow}
\begin{itemize}
  \item grammatikk -> antlr -> parser
  \item xquery -> parser -> visitor -> relalg
\end{itemize}

\section{Visible external API}
\begin{itemize}
  \item Vise hvordan oversetteren kan brukes i sin helhet i andre programmer
\end{itemize}

\section{Command line interface}
Dette er ikke s\aa~veldig viktig \aa~skrive om, men greit \aa~ha med.
\begin{itemize}
  \item Argsengine
  \item Aksepterer flere strenger og filer
  \item Outputter til graphviz/dot og pdf, hvis tilgjengelig
  \item Dependencies (jar-filer og drit)
\end{itemize}

\section{Optimalisations?}

\section{Summary}
\label{sect:impl:summary}
\begin{itemize}
  \item sammendrag av dette kap
\end{itemize}