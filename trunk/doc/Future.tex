\chapter{Future Work}
\label{sect:summary:future_work}
\label{chapter:future}
\label{sect:future:improvements}

Even though the outcome of this project is a fairly well-working parser
frontend, there is still room for improvement and other future work. In this
chapter we will summarize proposed changes to further improve the quality and
functionality of the XQuery parser produced in this project.

In its current state, the parser produced throughout this project could be a good
starting point for writing a tree parser, and eventually translating the AST
into relational algebra for use with relational database systems. As briefly
mentioned in section \ref{sect:discussion:ast:structuring}, ANTLR is capable of
producing tree parsers based on AST rewrite rules. This implies that ANTLR is a
natural choice for continued development of this parser.

Further it would be of particular interest to benchmark the raw query execution
performance and compare it to other similar solutions, and also compare various
lexer strategies to let performance be a factor of consideration in the future
when and if a new lexer strategy is to be chosen.

In addition to the future work just discussed, we propose the following changes
to the current parser implementation:
\begin{itemize}
\item \textbf{Not State Driven Lexer} -- By employing the island grammars or
manual and island grammar hybrid strategy (as discussed in section
\ref{sect:discussion:stateDriven}) instead of the state driven solution the
lexer currently utilizes, lexer grammar readability and simplicity could be
substantially increased. When the ANTLR framework in the future supports island
grammars
\footnote{\url{http://www.antlr.org/wiki/display/ANTLR3/island+grammar+formalization}}
this would really be an amendment to consider. The hybrid strategy is also a
good alternative, but this solution could lead to considerably more
work.

\item \textbf{Replacing Escaped Characters} -- As yet, when our parser come
upon escaped characters, character references or entity references it
indiscriminately validate them and move on. That is, phrases such as
\verb!"abc{{}}"! in a XML attribute declaration will have the same value after
it is matched by the parser, eventhough the double brackets are a way of
expressing the intent of a single one. All such character replacement
occurences belongs to the container lexer rules (ref. section
\ref{sect:rewriteGrammar:containerTokens}). A simple solution would be update
the \verb!text! attribute(ref. section \ref{sect:antlr:lexer}) of the tokens
involved according to a a table where an input escaped character sequence
yields the corresponding intended character.

\item \textbf{Separating NCName and Keywords} -- Our current lexer separates
NCNames from keywords by assuming that all keywords are NCNames, checking if
the matched text could be a keyword and then set the type accordingly, as
described in section \ref{sect:rewritegrammar:keywordNCName}. The check is
implemented as a \verb!if..else if..! construct, which means a serial search
for a match. A better solution would be to look it up in e.g. a hashtable. This
problem will however disappear if a island grammar solution were to be
implemented, as the keyword and NCName productions would no longer need to be
\verb!fragment! rules.

\item \textbf{Further Reducing of Parser Lookahead} -- At present our parser utilizes a maximum of two tokens lookahead, with the exception of some syntactic predicates. To ensure that \emph{all}, and not just a vast majority of state transitions are timely, the overall lookahead should be reduced to one.

\item \textbf{Type inference and type checking} -- Currently there is no
implemented type inference or type checking system. This would be a crucial
feature for a complete XQuery parser.

\item \textbf{Scoping and symbol table lookups on AST} -- In this implementation
we added scoping and symbol tables inline in the grammar file. As discussed in
section \ref{sect:discussion:scoping_and_symtab}, it would be benefitial to
refactor this functionality into being performed in run-time on the AST.

\item \textbf{Further improved error handling} -- Error handling is somewhat
crippled due to reasons explained in section
\ref{sect:discussion:error_handling}. As proposed, a mechanism using the
observer pattern could possibly be used to solve this.

\end{itemize}





